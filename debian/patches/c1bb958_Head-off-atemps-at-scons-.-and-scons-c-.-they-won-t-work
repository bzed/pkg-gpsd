From c1bb958d4c4b73980355d5d24959f69bc46338be Mon Sep 17 00:00:00 2001
From: "Eric S. Raymond" <esr@thyrsus.com>
Date: Mon, 16 Apr 2012 11:41:43 -0400
Subject: [PATCH] Head off atemps at scons '.' and scons -c '.', they won't
 work.

---
 SConstruct    |    9 ++++++++-
 build.txt     |    8 --------
 www/cycle.png |  Bin 14040 -> 0 bytes
 3 files changed, 8 insertions(+), 9 deletions(-)
 delete mode 100644 www/cycle.png

--- a/SConstruct
+++ b/SConstruct
@@ -1199,6 +1199,14 @@ uninstall = env.Command('uninstall', '',
 env.AlwaysBuild(uninstall)
 env.Precious(uninstall)
 
+# Target selection for '.' is badly broken. This is a general scons problem,
+# not a glitch in this particular recipe. Avoid triggering the bug.
+
+def error_action(target, source, env):
+    from SCons.Errors import UserError
+    raise UserError, "Target selection for '.' is broken."
+AlwaysBuild(Alias(".", [], error_action))
+
 # Utility productions
 
 def Utility(target, source, action):
@@ -1619,7 +1627,6 @@ if os.path.exists("gpsd.c") and os.path.
                           ship_release,
                           upload_tags])
 
-
 # The following sets edit modes for GNU EMACS
 # Local Variables:
 # mode:python
--- a/build.txt
+++ b/build.txt
@@ -181,10 +181,6 @@ by specifying CC=gcc4 before the build c
 confuses the gcc-3.4.[23] optimizer at -O2 level, making it generate
 incorrect code.
 
-Do not try to use "scons ."; something in the built-in
-target-selection algorithm for the '.' target is very broken and the
-results will be unexpected and unhappy.
-
 After building, please run 'scons testregress' to test the correctness
 of the build.  It is not necessary to install first, but you do need
 to have "." in your $PATH to run regressions uninstalled.  Python is
@@ -246,10 +242,6 @@ The scons equivalent of 'make clean' is
 your source tree to a clean state as though you had just cloned or
 downloaded it.
 
-Do not try to use "scons -c ."; something in the built-in
-target-selection algorithm for the '.' target is very broken and it
-will try to remove installation targets in root space.
-
 == Cross-building ==
 
 The scons recipe is intended to support cross-building, in particular
