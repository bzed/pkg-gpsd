# Makefile.in
# $Modified: Thu Jan 22 11:55:32 1998 by brook $

srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sbindir = @sbindir@
mandir = @mandir@

INSTALL = @INSTALL@
mkinstalldirs = ${srcdir}/mkinstalldirs
## The C compiler

# What we use to compile C files.
# CC = cc
CC = @CC@

# The flags we use to compile C files.
CFLAGS = @CFLAGS@


## The C preprocessor.

# What we use for preprocessing.  (gcc -E -traditional-cpp)
CPP = @CPP_TRADITIONAL@

# Flags passed to the C preprocessor.  ()
CPPFLAGS = @CPPFLAGS@

# Definitions to be passed to the C preprocessor.  (-DHAVE_CONFIG_H)
DEFS = @DEFS@


## The Linker.

# Flags passed to the linker.  (-g -O)
LDFLAGS = @LDFLAGS@

# Use this for building statically linked executables with GCC.
# LDFLAGS = -static @LDFLAGS@


## Local libraries

# Math library (-lm)
LIBM       = @LIBM@
# C library (-lc)
LIBC       = @LIBC@

# All libraries shown above
LIBS = $(LIBM) $(LIBC)

# Network libraries
LIBNSL = @LIBNSL@
LIBSOCKET = @LIBSOCKET@
NETLIBS = $(LIBNSL) $(LIBSOCKET)

## X Libraries

# Special flags for linking with X.  (-L/usr/X11R5/lib)
X_LDFLAGS = @X_LIBS@

# Motif library.  (-lXm)
LIBXM = @XM_LIBS@

# Use this alternative for building `semistatic' executables
# where Motif libraries are statically linked in.
# LIBXM = -Wl,-Bstatic @XM_LIBS@ -Wl,-Bdynamic

# X extension library; needed for Athena and Motif >= 2.0.  (-lXext)
LIBXEXT = @XEXT_LIBS@

# Xpm library; needed for DDD and sometimes for Motif >= 2.0.  (-lXpm)
LIBXPM = @XPM_LIBS@

# Xp library; sometimes needed for Motif >= 2.1.  (-lXp)
LIBXP = @XP_LIBS@

# gen library; sometimes needed for Motif >= 2.0.  (-lgen)
LIBGEN = @LIBGEN@

# X toolkit library.  (-lXt)
LIBXT = @XT_LIBS@

# Xaw library.  (-lXaw)
LIBXAW = @XAW_LIBS@

# X library.  (-lSM -lICE -lX11 -lnsl -lsocket)
LIBX11 = @X_PRE_LIBS@ @X11_LIBS@ @X_EXTRA_LIBS@

# All libraries shown above
ALL_X_LIBS = $(X_LDFLAGS) $(LIBXM) $(LIBXP) $(LIBXPM) $(LIBXEXT) \
$(LIBXT) $(LIBX11) $(LIBGEN)


## C compile commands.
COMPILE.c = $(CC) $(CPPFLAGS) $(DEFS) $(CFLAGS) -c
LINK.c = $(CC) $(LDFLAGS)
COMPILE_AND_LINK.c = \
    $(CC) $(CPPFLAGS) $(DEFS) $(CFLAGS) $(LDFLAGS)

## Where to look for X include files.  (-I/usr/X11R5/include)
X_INCLUDE = @X_CFLAGS@

## Where to look for include files.
INCLUDE = -I. $(X_INCLUDE)

## Implicit rules.
.SUFFIXES: .c
.c.o:
	$(COMPILE.c) $(INCLUDE) -o $@ $<

## Libraries and object files
LIB_OBJECTS = netlib.o nmea_parse.o serial.o tm.o em.o send_nmea.o $(MOTIF_OBJECTS)


## Programs
PROGRAMS=gpsd gps

## Manual pages
PAGES=gpsd.1 libgpsd.3

## Motif dependent programs and object files
MOTIF_PROGRAMS=xgpsspeed @MISSING_MOTIF@gps
@MISSING_MOTIF@MOTIF_OBJECTS = display.o Tachometer.o

XGPSOBJS=xgpsspeed.o Tachometer.o

all: $(PROGRAMS) $(MOTIF_PROGRAMS) $(PAGES)

gpsd: gpsd.o libgpsd.a
	$(LINK.c) -o $@ gpsd.o -L. -lgpsd $(NETLIBS) $(LIBS)

gps: gps.o libgpsd.a
	$(LINK.c) -o $@ gps.o -L. -lgpsd $(ALL_X_LIBS) $(LIBS)

xgpsspeed: $(XGPSOBJS)
	$(LINK.c) -o $@ $(XGPSOBJS) -L. -lgpsd $(LIBXAW) $(ALL_X_LIBS) $(LIBS)

libgpsd.a:  $(LIB_OBJECTS)
	ar -r libgpsd.a $(LIB_OBJECTS)
	ranlib libgpsd.a

# Library parts
netlib.o: netlib.c gpsd.h
nmea_parse.o: nmea_parse.c
serial.o: serial.c gpsd.h
tm.o: tm.c gpsd.h
em.o: em.c gpsd.h
send_nmea.o: send_nmea.c gpsd.h

display.o: display.c gpsd.h
gps.o: gps.c gpsd.h version.h
gpsd.o: gpsd.c gpsd.h version.h
xgpsspeed.o: xgpsspeed.c gpsd.h xgpsspeed.icon

gpsd.1 gps.1 xgpsspeed.1: gpsd.xml
	xmlto man gpsd.xml

libgpsd.3: libgpsd.xml
	xmlto man libgpsd.xml

# Version is extracted from version.h; make sure gpsd.spec stays current!
VERS=$(shell sed <version.h -n -e '/[^"]*"\([0-9].*\)"/s//\1/p')

HEADERS = config.h gpsd.h TachometerP.h nmea.h Tachometer.h version.h xgpsspeed.icon

SOURCES = $(LIB_OBJECTS:.o=.c) $(PROGRAMS:=.c) $(MOTIF_PROGRAMS:=.c) $(HEADERS)
DOCS = README INSTALL COPYING HACKING TODO CHANGELOG gpsd.xml libgpsd.xml
MANPAGES = gpsd.1 libgpsd.3
XRESOURCES = Gps XGpsSpeed
CONFIGURATION = configure.in config.h.in Makefile.in configure Makefile install-sh
META = gpsd.spec gpsd.lsm
ALL = $(SOURCES) $(DOCS) $(XRESOURCES) $(CONFIGURATION) $(META) $(MANPAGES) 

gpsd-$(VERS).tar.gz: $(ALL)
	find $(ALL) -type f | sed "s:^:gpsd-$(VERS)/:" >MANIFEST
	(cd ..; ln -s gpsd gpsd-$(VERS))
	(cd ..; tar -czvf gpsd/gpsd-$(VERS).tar.gz `cat gpsd/MANIFEST`)
	(cd ..; rm gpsd-$(VERS))

dist: gpsd-$(VERS).tar.gz

install:
	$(mkinstalldirs) $(DESTDIR)${bindir}
	$(mkinstalldirs) $(DESTDIR)${sbindir}
	for app in ${PROGRAMS}; do \
		$(INSTALL) -m 755 $$app ${DESTDIR}${sbindir} ; \
	done
	for app in ${MOTIF_PROGRAMS}; do \
		$(INSTALL) -m 755 $$app ${DESTDIR}${bindir} ; \
	done
	$(INSTALL) -m 755 -o 0 -g 0 -d $(MANDIR)/man1/
	$(INSTALL) -m 755 -o 0 -g 0 gpsd.1 $(MANDIR)/man1/gpsd.1
	$(INSTALL) -m 755 -o 0 -g 0 -d $(MANDIR)/man3/
	$(INSTALL) -m 755 -o 0 -g 0 gpsd.1 $(MANDIR)/man3/libgpsd.1

clean:
	rm -f *.o *.a gpsd gps xgpsspeed *~ config.status

dist-clean: clean
	rm -f config.cache config.log
